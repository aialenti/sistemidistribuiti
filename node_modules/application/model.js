/* 
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

var mysql      = require('mysql');




var executeQuery = function(query,callback){
  var connection = mysql.createConnection({
    host     : 'localhost',
    user     : 'root',
    password : '',
    database : 'sistemidistribuiti',
    insecureAuth:true
  });

  connection.connect();
  connection.query(query, function(err, rows, fields) {
    if (err) throw err;
    callback(rows);
  });
  connection.end();
  
}

/**
 * @param data : 
 * var data = new Object;
 * data.select = ["username","password"];
 * data.from = "users";
 * data.where = [
 * {
   * 0: "username",
   * 1: "=",
   * 2: "andrea"
 * }
 * ];
 */
var searchQuery =  function(data){
  query = "";
  
  //select
  length = data.select.length;
  query += "SELECT ";
  for(i=0;i<length;i++){
    query += data.select[i]
    if(i<length-1)
      query += ", ";
    else query += " ";
  }
  //from
  query += " FROM "+ data.from;
  //where
  query += " WHERE ";
  length = data.where.length;
  for(i=0;i<length;i++){
    query += data.where[i][0]+data.where[i][1]+"'"+data.where[i][2]+"'";
    if(i<length-1)
      query +=" AND ";
  
  }
  return query;
}

  
var insertQuery = function(data){
  var query = "INSERT INTO "+data.tableName+" (";
  var length = data.fields.length;
  for(var i=0;i<length;i++){
    query += data.fields[i];
    if(i<length-1)
      query += ",";
  }
  query += ") VALUES (";
  
  for(var i=0;i<length;i++){
    if(data.values[i].match(/SELECT/))
      query += "("+data.values[i]+")";
    else
      query += "'"+data.values[i]+"'";
    if(i<length-1)
      query +=",";
  }
  query += ")";
  console.log(query)
  return query;
    
}

exports.insertQuery = insertQuery;
exports.searchQuery = searchQuery;
exports.executeQuery = executeQuery;